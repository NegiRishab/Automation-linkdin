name: Wake Render app every 5 minutes (24x7)

on:
  schedule:
    # Runs every 5 minutes, all day, every day (UTC time)
    - cron: "*/5 * * * *"
  workflow_dispatch: # allows manual trigger

jobs:
  wake:
    runs-on: ubuntu-latest

    steps:
      - name: Log start time
        run: echo "‚è∞ Starting Render wake-up at $(date -u)"

      - name: Ping Render health endpoint (with retry)
        run: |
          for i in {1..3}; do
            STATUS=$(curl -m 60 -s -o /dev/null -w "%{http_code}" https://automation-linkdin.onrender.com/health)
            echo "Attempt $i: HTTP $STATUS"
            if [ "$STATUS" -eq 200 ]; then
              echo "‚úÖ Health check OK at $(date -u)"
              exit 0
            fi
            echo "Retrying in 20 seconds..."
            sleep 20
          done
          echo "‚ùå Failed after 3 retries"
          exit 1

      - name: Confirm completion
        run: echo "üèÅ Render ping workflow completed at $(date -u)"
